CREATE procedure sp_ssrs_LinkTypeLinksPerPhysician(	@Database nvarchar(200),	@Matched int,	@NPI nvarchar(10),	@LinkType nvarchar(50))as/*declare@Database nvarchar(200),@Matched int,@NPI nvarchar(10),@LinkType nvarchar(50)set @Database = 'MORUSH'set @Matched = 0set @NPI = '1255310157'set @LinkType = 'Practice - Profile'exec sp_ssrs_LinkTypeLinksPerPhysician @Database, @Matched, @NPI, @LinkType*/declare@sql nvarchar(max),@parms nvarchar(max),@CR char(1)set @CR = char(13) set @sql = 'select isnull(id.CustomerSource, v.FirstName) as [System], v.NPI, v.FirstName, v.LastName, v.SearchEngine, v.SearchPattern, v.ResultNumber, v.LinkTarget, v.MatchRank, v.LinkType ' + @CRset @sql = @sql + 'from ' + @Database + '.dbo.vw_PhysicianSearch v ' + @CRset @sql = @sql + 'left join ' + @Database + '.dbo.PhysCustomerID id ' + @CRset @sql = @sql + 'on id.NPI = v.NPI ' + @CRset @sql = @sql + 'where v.LinkType is not null ' + @CRset @sql = @sql + 'and v.Status = ''Active'' ' + @CRset @sql = @sql + 'and (v.LinkType in (''Rating'',''Personal'') ' + @CRset @sql = @sql + 'or v.LinkType like ''Social -%'' ' + @CRset @sql = @sql + 'or v.LinkType like ''%- Directory'' ' + @CRset @sql = @sql + 'or v.LinkType like ''%- Profile'') ' + @CRset @sql = @sql + 'and v.NPI = ''' + @NPI + ''' ' + @CRset @sql = @sql + 'and v.LinkType = ''' + @LinkType + ''' ' + @CRif @Matched = 1begin	set @sql = @sql + 'and v.MatchRank > 0 ' + @CRendset @sql = @sql + 'order by [System], LastName, FirstName, MatchRank desc, ResultNumber, SearchEngine, SearchPattern, LinkTarget ' + @CRexec(@sql)
