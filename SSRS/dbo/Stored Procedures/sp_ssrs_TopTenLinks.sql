CREATE procedure sp_ssrs_TopTenLinks (@Database nvarchar(200))as/*declare @Database nvarchar(200) = 'Competition_C'exec sp_ssrs_TopTenLinks @Database*/declare@CustomerID nvarchar(50),@CustomerSource nvarchar(120),@sql nvarchar(max),@parms nvarchar(max),@CR char(1)set @CR = char(13)set @sql = 'select distinct PrimaryCustomerSource, LastName, FirstName, LinkTarget, dbo.fn_GetDomain(LinkTarget) as Domain ' + @CRset @sql = @sql + 'from [' + @Database + '].dbo.vw_PhysicianSearch ' + @CRset @sql = @sql + 'where cast(ResultNumber as int) < 11 ' + @CRset @sql = @sql + 'and LinkType is null ' + @CRset @sql = @sql + 'and LinkTarget not like ''%.pdf'' ' + @CRset @sql = @sql + 'and LinkTarget not like ''%.doc'' ' + @CRset @sql = @sql + 'and LinkTarget not like ''%.docx'' ' + @CRset @sql = @sql + 'and LinkTarget not like ''%.txt'' ' + @CRset @sql = @sql + 'and LinkTarget not like ''%.xls'' ' + @CRset @sql = @sql + 'and LinkTarget not like ''%.xlsx'' ' + @CRset @sql = @sql + 'order by Domain, PrimaryCustomerSource, LastName, FirstName, LinkTarget 'exec(@sql)